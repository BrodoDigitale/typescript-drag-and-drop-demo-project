(()=>{"use strict";function e(e,t,r){const n=r.value;return{configurable:!0,get(){return n.bind(this)}}}var t;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(t||(t={}));class r{constructor(e,t,r,n,s){this.id=e,this.title=t,this.description=r,this.people=n,this.projectStatus=s}}class n{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class s extends n{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new s),this.instance}addProject(e,n,s){const i=new r(Math.random().toString(),e,n,s,t.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const r=this.projects.find((t=>t.id===e));r&&r.projectStatus!==t&&(r.projectStatus=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const i=s.getInstance();function o(e){let t=!0;return e.required&&(t=t&&e.property.toString().trim().length>0),e.minLength&&"string"==typeof e.property&&(t=t&&e.property.trim().length>=e.minLength),e.maxLength&&"string"==typeof e.property&&(t=t&&e.property.trim().length<=e.maxLength),e.min&&"number"==typeof e.property&&(t=t&&e.property>=e.min),e.max&&"number"==typeof e.property&&(t=t&&e.property<=e.max),t}class l{constructor(e,t,r,n){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,n&&(this.element.id=n),this.render(r)}render(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}class p extends l{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}inputValuesCollector(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,r=this.peopleInputElement.value,n={property:t,required:!0,minLength:5},s={property:+r,required:!0,min:1,max:9};if(o({property:e,required:!0})&&o(n)&&o(s))return[e,t,+r];alert("invalid input!")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.inputValuesCollector();if(t){const[e,r,n]=t;i.addProject(e,r,n),this.clearInputs()}}}!function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);i>3&&o&&Object.defineProperty(t,r,o)}([e],p.prototype,"submitHandler",null);var c=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};class a extends l{get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons,this.element.querySelector("p").textContent=this.project.description}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("drag ended")}}c([e],a.prototype,"dragStartHandler",null),c([e],a.prototype,"dragEndHandler",null);var d=function(e,t,r,n){var s,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,r,o):s(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};class u extends l{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),i.addListener((e=>{this.assignedProjects=e.filter((e=>"active"===this.type?e.projectStatus===t.Active:e.projectStatus===t.Finished)),this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new a(this.element.querySelector("ul").id,e)}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const r=e.dataTransfer.getData("text/plain");i.moveProject(r,"active"===this.type?t.Active:t.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}}d([e],u.prototype,"dragOverHandler",null),d([e],u.prototype,"dropHandler",null),d([e],u.prototype,"dragLeaveHandler",null),new p,new u("active"),new u("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBa0JQLEVBQWN5QixPQUV0Q00sRUFBSXhCLGdCQUFrQlAsRUFBY3FHLFdBRTdDdEcsS0FBS3VHLGdCQUFnQixHQUV6QixDQUNBL0IsZ0JBQ0UsTUFBTWdDLEVBQVMsR0FBR3hHLEtBQUtnRyxxQkFDdkJoRyxLQUFLNEQsUUFBUU0sY0FBYyxNQUFPOUQsR0FBS29HLEVBQ3ZDeEcsS0FBSzRELFFBQVFNLGNBQWMsTUFBT3VCLFlBQ2hDekYsS0FBS2dHLEtBQUtTLGNBQWdCLFdBQzlCLENBQ1FGLGlCQUNTakQsU0FBU0MsZUFDdEIsR0FBR3ZELEtBQUtnRyxzQkFHSFUsVUFBWSxHQUNuQixJQUFLLE1BQU1DLEtBQVczRyxLQUFLaUcsaUJBQ3pCLElBQUliLEVBQVlwRixLQUFLNEQsUUFBUU0sY0FBYyxNQUFPOUQsR0FBSXVHLEVBRTFELENBRUFULGdCQUFnQmpCLEdBRVZBLEVBQU1TLGNBQWdELGVBQWhDVCxFQUFNUyxhQUFha0IsTUFBTSxLQUVqRDNCLEVBQU1DLGlCQUNObEYsS0FBSzRELFFBQVFNLGNBQWMsTUFBTzJDLFVBQVVDLElBQUksYUFFcEQsQ0FFQVYsWUFBWW5CLEdBQ1YsTUFBTThCLEVBQVE5QixFQUFNUyxhQUFjc0IsUUFBUSxjQUMxQzdFLEVBQWFQLFlBQ1htRixFQUNjLFdBQWQvRyxLQUFLZ0csS0FBb0IvRixFQUFjeUIsT0FBU3pCLEVBQWNxRyxTQUVsRSxDQUVBSCxpQkFBaUIzRyxHQUNmUSxLQUFLNEQsUUFBUU0sY0FBYyxNQUFPMkMsVUFBVUksT0FBTyxZQUNyRCxFQW5CQSxHQURDMUgsRyxvQ0FVRCxHQURDQSxHLGdDQVNELEdBRENBLEcscUNDbEVILElBQUl5RSxFQUNKLElBQUkrQixFQUFZLFVBQ2hCLElBQUlBLEVBQVksVyIsInNvdXJjZXMiOlsid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9kZWNvcmF0b3JzL2F1dG9iaW5kLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9tb2RlbHMvcHJvamVjdC1tb2RlbC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvc3RhdGUvcHJvamVjdC1zdGF0ZS50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvdXRpbC92YWxpZGF0aW9uLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vYXV0b2JpbmQgZGVjb3JhdG9yXG4gIGV4cG9ydCBmdW5jdGlvbiBhdXRvYmluZChfOiBhbnksIF8yOiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgICAvL21vZGlmeSBpdFxuICAgIGNvbnN0IG1vZGlmaWVkRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0KCkge1xuICAgICAgICBjb25zdCBib3VuZEZuID0gb3JpZ2luYWxNZXRob2QuYmluZCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIG1vZGlmaWVkRGVzY3JpcHRvcjtcbiAgfVxuIiwiZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7XG4gIEFjdGl2ZSxcbiAgRmluaXNoZWQsXG59XG5leHBvcnQgY2xhc3MgUHJvamVjdCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBpZDogc3RyaW5nLFxuICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nLFxuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLFxuICAgIHB1YmxpYyBwZW9wbGU6IG51bWJlcixcbiAgICBwdWJsaWMgcHJvamVjdFN0YXR1czogUHJvamVjdFN0YXR1c1xuICApIHt9XG59XG4iLCJpbXBvcnQgeyBQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSBcIi4uL21vZGVscy9wcm9qZWN0LW1vZGVsXCI7XG5cbi8vTGlzdGVuZXIgdHlwZVxudHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xuXG4vL2Jhc2UgY2xhc3MgZm9yIHN0YXRlXG5jbGFzcyBTdGF0ZTxUPiB7XG4gIC8vY2Fubm90IGJlIGFjY2Vzc2VkIGZyb20gb3V0c2lkZSBidXQgY2FuIGJlIGFjY2Vzc2VkIGJ5IGNsYXNzIHRoYXQgaW5oZXJpdGVzXG4gIHByb3RlY3RlZCBsaXN0ZW5lcnM6IExpc3RlbmVyPFQ+W10gPSBbXTtcblxuICBhZGRMaXN0ZW5lcihsaXN0ZW5lckZuOiBMaXN0ZW5lcjxUPikge1xuICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXJGbik7XG4gIH1cbn1cbmV4cG9ydCBjbGFzcyBQcm9qZWN0U3RhdGUgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PiB7XG4gIC8vbGlzdCBvZiBhbGwgcHJvamVjdHNcbiAgcHJpdmF0ZSBwcm9qZWN0czogUHJvamVjdFtdID0gW107XG5cbiAgLy90b2dldGhlciB3aXRoIGdldEluc3RhbmNlIGd1YXJhbnRlZXMgdGhhdCB3ZSBhcmUgYWx3YXlzIHdvcmtpbmcgd2l0aCB0aGUgc2FtZSBpbnN0YW5jZSBvZiBzdGF0ZVxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICBpZiAodGhpcy5pbnN0YW5jZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gICAgfVxuICAgIHRoaXMuaW5zdGFuY2UgPSBuZXcgUHJvamVjdFN0YXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gIH1cblxuICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2M6IHN0cmluZywgbnVtT2ZQZW9wbGU6IG51bWJlcikge1xuICAgIGNvbnN0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChcbiAgICAgIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKSxcbiAgICAgIHRpdGxlLFxuICAgICAgZGVzYyxcbiAgICAgIG51bU9mUGVvcGxlLFxuICAgICAgUHJvamVjdFN0YXR1cy5BY3RpdmVcbiAgICApO1xuICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICAvL2FmdGVyIHByb2plY3QgaXMgYWRkZWQgbG9vcCB0aHJvdWdoIGFsbCBsaXN0ZW5lcnMgYW5kIGNhbGwgdGhlbVxuICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gIH1cblxuICBtb3ZlUHJvamVjdChpZDogc3RyaW5nLCBuZXdTdGF0dXM6IFByb2plY3RTdGF0dXMpIHtcbiAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0cy5maW5kKChwcmopID0+IHByai5pZCA9PT0gaWQpO1xuICAgIGlmIChwcm9qZWN0ICYmIHByb2plY3QucHJvamVjdFN0YXR1cyAhPT0gbmV3U3RhdHVzKSB7XG4gICAgICBwcm9qZWN0LnByb2plY3RTdGF0dXMgPSBuZXdTdGF0dXM7XG4gICAgICB0aGlzLnVwZGF0ZUxpc3RlbmVycygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlTGlzdGVuZXJzKCkge1xuICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgIC8vc2xpY2UgaXMgdXNlZCBqdXN0IHRvIHBhc3MgYSBjb3B5IG9mIHByb2plY3RzLCBub3QgdGhlIG9yaWdpbmFsIGFycmF5XG4gICAgICAvL2NhbiBiZSBzdWJzdGl0dXRlZCB3aXRoIFsuLi50aGlzLnByb2plY3RzXVxuICAgICAgbGlzdGVuZXIodGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcbiAgICB9XG4gIH1cbn1cblxuLy9Qcm9qZWN0U3RhdGUgY2FuIE9OTFkgYmUgaW5zdGFuY2lhdGVkIHZpYSBnZXRJbnN0YW5jZSBiZWNhdXNlIGl0J3MgY29uc3RydWN0b3IgaXMgcHJpdmF0ZVxuLy9zbyBndWFyYW50ZWVzIHRoZXJlIGFsd2F5cyB3aWxsIGJlIG9ubHkgb25lIG9iamVjdCBvZiB0aGUgdHlwZSBpbiBhcHAgLSBTSU5HTEVUT05cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbiIsIiAgZXhwb3J0IGludGVyZmFjZSB2YWxpZGF0aW9uT2JqZWN0IHtcbiAgICBwcm9wZXJ0eTogc3RyaW5nIHwgbnVtYmVyO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgIG1pbj86IG51bWJlcjtcbiAgICBtYXg/OiBudW1iZXI7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gdmFsaWRhdGUodmFsaWRhdGFibGVJbnB1dDogdmFsaWRhdGlvbk9iamVjdCkge1xuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5yZXF1aXJlZCkge1xuICAgICAgaXNWYWxpZCA9XG4gICAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC5wcm9wZXJ0eS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggPiAwO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICB2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aCAmJlxuICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQucHJvcGVydHkgPT09IFwic3RyaW5nXCJcbiAgICApIHtcbiAgICAgIGlzVmFsaWQgPVxuICAgICAgICBpc1ZhbGlkICYmXG4gICAgICAgIHZhbGlkYXRhYmxlSW5wdXQucHJvcGVydHkudHJpbSgpLmxlbmd0aCA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aDtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggJiZcbiAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnByb3BlcnR5ID09PSBcInN0cmluZ1wiXG4gICAgKSB7XG4gICAgICBpc1ZhbGlkID1cbiAgICAgICAgaXNWYWxpZCAmJlxuICAgICAgICB2YWxpZGF0YWJsZUlucHV0LnByb3BlcnR5LnRyaW0oKS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pbiAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC5wcm9wZXJ0eSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC5wcm9wZXJ0eSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbjtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWF4ICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnByb3BlcnR5ID09PSBcIm51bWJlclwiKSB7XG4gICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnByb3BlcnR5IDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4O1xuICAgIH1cbiAgICByZXR1cm4gaXNWYWxpZDtcbiAgfSIsIi8vYWJzdHJhY3QgdGVsbHMgdXMgdGhhdCB0aGlzIGNsYXNzIHNob3VsZCBuZXZlciBiZSBpbnN0YW5jaWF0ZWQgYW5kIHVzZWQgZm9yIGluaGVyaXRhbmNlIG9ubHlcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcbiAgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xuICBob3N0RWxlbWVudDogVDtcbiAgZWxlbWVudDogVTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICB0ZW1wbGF0ZUlkOiBzdHJpbmcsXG4gICAgaG9zdEVsZW1lbnRJZDogc3RyaW5nLFxuICAgIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sXG4gICAgbmV3RWxlbWVudElkPzogc3RyaW5nXG4gICkge1xuICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgICB0ZW1wbGF0ZUlkXG4gICAgKSEgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcbiAgICB0aGlzLmhvc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRJZCkhIGFzIFQ7XG5cbiAgICBjb25zdCBpbXBvcnRlZE5vZGUgPSBkb2N1bWVudC5pbXBvcnROb2RlKFxuICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCxcbiAgICAgIHRydWVcbiAgICApO1xuICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZCBhcyBVO1xuICAgIGlmIChuZXdFbGVtZW50SWQpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5pZCA9IG5ld0VsZW1lbnRJZDtcbiAgICB9XG5cbiAgICB0aGlzLnJlbmRlcihpbnNlcnRBdFN0YXJ0KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyKGluc2VydEF0U3RhcnQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmhvc3RFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcbiAgICAgIGluc2VydEF0U3RhcnQgPyBcImFmdGVyYmVnaW5cIiA6IFwiYmVmb3JlZW5kXCIsXG4gICAgICB0aGlzLmVsZW1lbnRcbiAgICApO1xuICB9XG5cbiAgLy9tZXRob2RzIGFyZSB2b2lkIGJ1dCB0aGV5IGZvcmNlIGFueSBpbmhlcml0ZWQgY2xhc3MgdG8gaW1wbGVtZW50IHRoZW0gKG9ubHkgdGhvc2Ugd2l0aG91dD8gYWN0dWFsbHkpXG4gIGFic3RyYWN0IGNvbmZpZ3VyZT8oKTogdm9pZDtcbiAgYWJzdHJhY3QgcmVuZGVyQ29udGVudCgpOiB2b2lkO1xufVxuIiwiaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tIFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZFwiO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCB7IHZhbGlkYXRlLCB2YWxpZGF0aW9uT2JqZWN0IH0gZnJvbSBcIi4uL3V0aWwvdmFsaWRhdGlvblwiO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcblxuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XG4gIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKFwicHJvamVjdC1pbnB1dFwiLCBcImFwcFwiLCB0cnVlLCBcInVzZXItaW5wdXRcIik7XG4gICAgdGhpcy50aXRsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIjdGl0bGVcIlxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNkZXNjcmlwdGlvblwiXG4gICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHRoaXMucGVvcGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNwZW9wbGVcIlxuICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gIH1cbiAgLy9wcml2YXRlIGlzIHJlbW92ZWQgYmVjYXVzZSBhYnN0YXJjdCBtZXRob2QgY2Fubm90IGJlIHByaXZhdGVcbiAgLy9wdWJsaWMgbWV0aG9kcyBhbHdheXMgZGVjbGFyZWQgYmVmb3JlIHByaXZhdGVcbiAgY29uZmlndXJlKCkge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuc3VibWl0SGFuZGxlcik7XG4gIH1cbiAgLy9hZGRlZCBqdXN0IGJlY2F1c2UgYmFzZSBjbGFzcyByZXF1aXJlcyBpdFxuICByZW5kZXJDb250ZW50KCkge31cbiAgLy9pZiBpbnB1dCBpcyBpbnZhbGlkIC0tPiB2b2lkIHJldHVybiBlbHNlIGEgdHVwbGVcbiAgcHJpdmF0ZSBpbnB1dFZhbHVlc0NvbGxlY3RvcigpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkIHtcbiAgICBjb25zdCB0aXRsZUlucHV0ID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICBjb25zdCBkZXNjcmlwdGlvbklucHV0ID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcbiAgICBjb25zdCBwZW9wbGVJbnB1dCA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuXG4gICAgY29uc3QgdGl0bGVJbnB1dFZhbGlkYXRpb246IHZhbGlkYXRpb25PYmplY3QgPSB7XG4gICAgICBwcm9wZXJ0eTogdGl0bGVJbnB1dCxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIH07XG4gICAgY29uc3QgZGVzY3JpcHRpb25JbnB1dFZhbGlkYXRpb246IHZhbGlkYXRpb25PYmplY3QgPSB7XG4gICAgICBwcm9wZXJ0eTogZGVzY3JpcHRpb25JbnB1dCxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgbWluTGVuZ3RoOiA1LFxuICAgIH07XG4gICAgY29uc3QgcGVvcGxlSW5wdXRWYWxpZGF0aW9uOiB2YWxpZGF0aW9uT2JqZWN0ID0ge1xuICAgICAgcHJvcGVydHk6ICtwZW9wbGVJbnB1dCxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgbWluOiAxLFxuICAgICAgbWF4OiA5LFxuICAgIH07XG5cbiAgICBpZiAoXG4gICAgICAhdmFsaWRhdGUodGl0bGVJbnB1dFZhbGlkYXRpb24pIHx8XG4gICAgICAhdmFsaWRhdGUoZGVzY3JpcHRpb25JbnB1dFZhbGlkYXRpb24pIHx8XG4gICAgICAhdmFsaWRhdGUocGVvcGxlSW5wdXRWYWxpZGF0aW9uKVxuICAgICkge1xuICAgICAgYWxlcnQoXCJpbnZhbGlkIGlucHV0IVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFt0aXRsZUlucHV0LCBkZXNjcmlwdGlvbklucHV0LCArcGVvcGxlSW5wdXRdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJJbnB1dHMoKSB7XG4gICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vdmFsaWRhdGUgaW5wdXRzXG4gICAgLy9kbyBzb21ldGhpbmcgd2l0aCBkYXRhXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB0aGlzLmlucHV0VmFsdWVzQ29sbGVjdG9yKCk7XG4gICAgaWYgKGlucHV0VmFsdWVzKSB7XG4gICAgICBjb25zdCBbdGl0bGUsIGRlc2NyaXB0aW9uLCBwZW9wbGVdID0gaW5wdXRWYWx1ZXM7XG4gICAgICBwcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZSk7XG4gICAgICB0aGlzLmNsZWFySW5wdXRzKCk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gXCIuLi9kZWNvcmF0b3JzL2F1dG9iaW5kXCI7XG5pbXBvcnQgeyBEcmFnZ2FibGUgfSBmcm9tIFwiLi4vbW9kZWxzL2ludGVyZmFjZXNcIjtcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3QtbW9kZWxcIjtcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG5cbi8vUHJvamVjdEl0ZW0gQ2xhc3NcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SXRlbVxuICBleHRlbmRzIENvbXBvbmVudDxIVE1MVUxpc3RFbGVtZW50LCBIVE1MTElFbGVtZW50PlxuICBpbXBsZW1lbnRzIERyYWdnYWJsZVxue1xuICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XG5cbiAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcbiAgICAgIHJldHVybiBcIjEgcGVyc29uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYDtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihob3N0SWQ6IHN0cmluZywgcHJvamVjdDogUHJvamVjdCkge1xuICAgIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcblxuICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gIH1cbiAgY29uZmlndXJlKCk6IHZvaWQge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIHRoaXMuZHJhZ1N0YXJ0SGFuZGxlcik7XG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIHRoaXMuZHJhZ0VuZEhhbmRsZXIpO1xuICB9XG4gIHJlbmRlckNvbnRlbnQoKTogdm9pZCB7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMlwiKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoM1wiKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnM7XG4gICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJwXCIpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIC8vd2UgbmVlZCB0byBiaW5kIGl0IGFzIGl0IGdldHMgcGFzc2VkIGFzIGEgY2FsbGJhY2sgZm9yIGV2ZW50TGlzdGVuZXJlc1xuICBAYXV0b2JpbmRcbiAgZHJhZ1N0YXJ0SGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgLy90cmFuc2ZlciBqdXN0IGlkIG9mIHRoZSBwcm9qZWN0XG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5zZXREYXRhKFwidGV4dC9wbGFpblwiLCB0aGlzLnByb2plY3QuaWQpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xuICB9XG4gIEBhdXRvYmluZFxuICBkcmFnRW5kSGFuZGxlcihfOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhcImRyYWcgZW5kZWRcIik7XG4gIH1cbn1cbiIsImltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IERyb3BwYWJsZSB9IGZyb20gXCIuLi9tb2RlbHMvaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdC1tb2RlbFwiO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG5pbXBvcnQgeyBQcm9qZWN0SXRlbSB9IGZyb20gXCIuL3Byb2plY3QtaXRlbVwiO1xuXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3RcbiAgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxFbGVtZW50PlxuICBpbXBsZW1lbnRzIERyb3BwYWJsZVxue1xuICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0eXBlOiBcImFjdGl2ZVwiIHwgXCJmaW5pc2hlZFwiKSB7XG4gICAgc3VwZXIoXCJwcm9qZWN0LWxpc3RcIiwgXCJhcHBcIiwgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XG4gICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gW107XG4gICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgfVxuICAvL2FkZCBlbXByeSBtZXRob2QgYmVjYXVzZSBjbGFzcyByZXF1aWVyZXMgaXRcbiAgY29uZmlndXJlKCkge1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2xlYXZlXCIsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XG4gICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuZHJvcEhhbmRsZXIpO1xuXG4gICAgLy9wcm9qZWN0cyB3aWxsIGJlIHRha2VuIGZyb20gaW5zaWRlIG9mIHRoZSBjbGFzc1xuICAgIHByb2plY3RTdGF0ZS5hZGRMaXN0ZW5lcigocHJvamVjdHM6IFByb2plY3RbXSkgPT4ge1xuICAgICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gcHJvamVjdHMuZmlsdGVyKChwcmopID0+IHtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gXCJhY3RpdmVcIikge1xuICAgICAgICAgIHJldHVybiBwcmoucHJvamVjdFN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByai5wcm9qZWN0U3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgfSk7XG4gIH1cbiAgcmVuZGVyQ29udGVudCgpIHtcbiAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkID0gbGlzdElkO1xuICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikhLnRleHRDb250ZW50ID1cbiAgICAgIHRoaXMudHlwZS50b1VwcGVyQ2FzZSgpICsgXCIgUFJPSkVDVFNcIjtcbiAgfVxuICBwcml2YXRlIHJlbmRlclByb2plY3RzKCkge1xuICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgICAgYCR7dGhpcy50eXBlfS1wcm9qZWN0cy1saXN0YFxuICAgICkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgLy90byBjbGVhciBvdXQgYWxsIHRoZSBsaXN0IGFuZCBhdm9pZCBkb3VibGUgcmVuZGVyIG9mIHRhc2tzXG4gICAgbGlzdEVsLmlubmVySFRNTCA9IFwiXCI7XG4gICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmlkLCBwcmpJdGVtKTtcbiAgICB9XG4gIH1cbiAgQGF1dG9iaW5kXG4gIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgLy9jaGVjayB0aGF0IGRyb3BwaW5nIGlzIGFsbG93ZWRcbiAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgIC8vYmVjYXVzZSBkZWZhdWx0IGlzIG5vdCBhbGxvd2luZyBkcm9wcGluZyBzbyB3ZSBzaG91bGQgcHJldmVudCBpdFxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikhLmNsYXNzTGlzdC5hZGQoXCJkcm9wcGFibGVcIik7XG4gICAgfVxuICB9XG4gIEBhdXRvYmluZFxuICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xuICAgIHByb2plY3RTdGF0ZS5tb3ZlUHJvamVjdChcbiAgICAgIHByaklkLFxuICAgICAgdGhpcy50eXBlID09PSBcImFjdGl2ZVwiID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkXG4gICAgKTtcbiAgfVxuICBAYXV0b2JpbmRcbiAgZHJhZ0xlYXZlSGFuZGxlcihfOiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpIS5jbGFzc0xpc3QucmVtb3ZlKFwiZHJvcHBhYmxlXCIpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBQcm9qZWN0SW5wdXQgfSBmcm9tIFwiLi9jb21wb25lbnRzL3Byb2plY3QtaW5wdXRcIjtcbmltcG9ydCB7IFByb2plY3RMaXN0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWxpc3RcIjtcblxubmV3IFByb2plY3RJbnB1dCgpO1xubmV3IFByb2plY3RMaXN0KFwiYWN0aXZlXCIpO1xubmV3IFByb2plY3RMaXN0KFwiZmluaXNoZWRcIik7XG4iXSwibmFtZXMiOlsiYXV0b2JpbmQiLCJfIiwiXzIiLCJkZXNjcmlwdG9yIiwib3JpZ2luYWxNZXRob2QiLCJ2YWx1ZSIsImNvbmZpZ3VyYWJsZSIsImdldCIsImJpbmQiLCJ0aGlzIiwiUHJvamVjdFN0YXR1cyIsIlByb2plY3QiLCJjb25zdHJ1Y3RvciIsImlkIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInBlb3BsZSIsInByb2plY3RTdGF0dXMiLCJTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJQcm9qZWN0U3RhdGUiLCJzdXBlciIsInByb2plY3RzIiwic3RhdGljIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwiZGVzYyIsIm51bU9mUGVvcGxlIiwibmV3UHJvamVjdCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsIkFjdGl2ZSIsInVwZGF0ZUxpc3RlbmVycyIsIm1vdmVQcm9qZWN0IiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJwcmoiLCJsaXN0ZW5lciIsInNsaWNlIiwicHJvamVjdFN0YXRlIiwiZ2V0SW5zdGFuY2UiLCJ2YWxpZGF0ZSIsInZhbGlkYXRhYmxlSW5wdXQiLCJpc1ZhbGlkIiwicmVxdWlyZWQiLCJwcm9wZXJ0eSIsInRyaW0iLCJsZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtaW4iLCJtYXgiLCJDb21wb25lbnQiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRJZCIsImluc2VydEF0U3RhcnQiLCJuZXdFbGVtZW50SWQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsInJlbmRlciIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlByb2plY3RJbnB1dCIsInRpdGxlSW5wdXRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImRlc2NyaXB0aW9uSW5wdXRFbGVtZW50IiwicGVvcGxlSW5wdXRFbGVtZW50IiwiY29uZmlndXJlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJyZW5kZXJDb250ZW50IiwiaW5wdXRWYWx1ZXNDb2xsZWN0b3IiLCJ0aXRsZUlucHV0IiwiZGVzY3JpcHRpb25JbnB1dCIsInBlb3BsZUlucHV0IiwiZGVzY3JpcHRpb25JbnB1dFZhbGlkYXRpb24iLCJwZW9wbGVJbnB1dFZhbGlkYXRpb24iLCJhbGVydCIsImNsZWFySW5wdXRzIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImlucHV0VmFsdWVzIiwiUHJvamVjdEl0ZW0iLCJwZXJzb25zIiwiaG9zdElkIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRyYWdFbmRIYW5kbGVyIiwidGV4dENvbnRlbnQiLCJkYXRhVHJhbnNmZXIiLCJzZXREYXRhIiwiZWZmZWN0QWxsb3dlZCIsImNvbnNvbGUiLCJsb2ciLCJQcm9qZWN0TGlzdCIsInR5cGUiLCJhc3NpZ25lZFByb2plY3RzIiwiZHJhZ092ZXJIYW5kbGVyIiwiZHJhZ0xlYXZlSGFuZGxlciIsImRyb3BIYW5kbGVyIiwiZmlsdGVyIiwiRmluaXNoZWQiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIiwiaW5uZXJIVE1MIiwicHJqSXRlbSIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwicHJqSWQiLCJnZXREYXRhIiwicmVtb3ZlIl0sInNvdXJjZVJvb3QiOiIifQ==